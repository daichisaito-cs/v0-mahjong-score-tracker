{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/daichi/insane/workspace/playground/v0-mahjong-score-tracker/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Server Component context - ignore\n        }\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,sXAAO;IAEjC,OAAO,IAAA,sXAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,oCAAoC;gBACtC;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/daichi/insane/workspace/playground/v0-mahjong-score-tracker/components/game-record-form.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const GameRecordForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call GameRecordForm() from the server but GameRecordForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/insane/workspace/playground/v0-mahjong-score-tracker/components/game-record-form.tsx <module evaluation>\",\n    \"GameRecordForm\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,iBAAiB,IAAA,ofAAuB,EACjD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,sHACA","ignoreList":[0]}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/daichi/insane/workspace/playground/v0-mahjong-score-tracker/components/game-record-form.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const GameRecordForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call GameRecordForm() from the server but GameRecordForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/insane/workspace/playground/v0-mahjong-score-tracker/components/game-record-form.tsx\",\n    \"GameRecordForm\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,iBAAiB,IAAA,ofAAuB,EACjD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,kGACA","ignoreList":[0]}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///Users/daichi/insane/workspace/playground/v0-mahjong-score-tracker/app/%28authenticated%29/games/new/page.tsx"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\nimport { redirect } from \"next/navigation\"\nimport { GameRecordForm } from \"@/components/game-record-form\"\n\nexport default async function NewGamePage({\n  searchParams,\n}: {\n  searchParams?: Promise<{ league?: string; session?: string }>\n}) {\n  const resolvedSearchParams = searchParams ? await searchParams : {}\n  const leagueParam = resolvedSearchParams?.league\n  const sessionParam = resolvedSearchParams?.session\n\n  let sessionData = null\n  if (sessionParam) {\n    try {\n      sessionData = JSON.parse(decodeURIComponent(sessionParam))\n    } catch (err) {\n      console.error(\"[v0] Failed to parse session data:\", err)\n    }\n  }\n  const supabase = await createClient()\n\n  const { data: userData, error } = await supabase.auth.getUser()\n  if (error || !userData?.user) {\n    redirect(\"/auth/login\")\n  }\n\n  // 自分のプロフィール取得\n  const { data: myProfile } = await supabase.from(\"profiles\").select(\"*\").eq(\"id\", userData.user.id).single()\n\n  const friends: { id: string; display_name: string; avatar_url?: string | null }[] = []\n\n  try {\n    const { data: friendships, error: friendshipsError } = await supabase\n      .from(\"friendships\")\n      .select(\"requester_id, addressee_id\")\n      .eq(\"status\", \"accepted\")\n      .or(`requester_id.eq.${userData.user.id},addressee_id.eq.${userData.user.id}`)\n\n    if (friendshipsError) {\n      console.error(\"[v0] Failed to fetch friendships:\", friendshipsError)\n    } else if (friendships && friendships.length > 0) {\n      const friendIds = friendships.map((fs) => {\n        return fs.requester_id === userData.user.id ? fs.addressee_id : fs.requester_id\n      })\n\n      const { data: profiles, error: profilesError } = await supabase\n        .from(\"profiles\")\n        .select(\"id, display_name, avatar_url\")\n        .in(\"id\", friendIds)\n\n      if (profilesError) {\n        console.error(\"[v0] Failed to fetch friend profiles:\", profilesError)\n      } else if (profiles) {\n        friends.push(...profiles)\n      }\n    }\n  } catch (err) {\n    console.error(\"[v0] Error fetching friends:\", err)\n  }\n\n  // 自分がオーナーまたはメンバーのリーグを取得\n  const { data: ownedLeagues } = await supabase.from(\"leagues\").select(\"*\").eq(\"owner_id\", userData.user.id)\n\n  const { data: memberships } = await supabase\n    .from(\"league_members\")\n    .select(\"leagues(*)\")\n    .eq(\"user_id\", userData.user.id)\n\n  // リーグをマージして重複を除去\n  const memberLeagues = memberships?.map((m) => m.leagues).filter(Boolean) || []\n  const allLeagues = [...(ownedLeagues || []), ...memberLeagues]\n  const uniqueLeagues = allLeagues.filter(\n    (league, index, self) => league && index === self.findIndex((l) => l?.id === league?.id),\n  )\n\n  const { data: rules } = await supabase\n    .from(\"rules\")\n    .select(\"id, name, game_type, starting_points, return_points, uma_first, uma_second, uma_third, uma_fourth\")\n    .order(\"created_at\", { ascending: false })\n\n  return (\n    <div className=\"space-y-6 pb-20 md:pb-0 max-w-2xl mx-auto\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-foreground\">対局を記録</h1>\n        <p className=\"text-muted-foreground\">対局結果を入力してください</p>\n      </div>\n\n        <GameRecordForm\n          currentUserId={userData.user.id}\n          currentUserName={myProfile?.display_name || \"自分\"}\n          currentUserAvatarUrl={myProfile?.avatar_url || null}\n          leagues={(uniqueLeagues as any[]) || []}\n          rules={(rules as any[]) || []}\n          friends={friends}\n          defaultLeagueId={sessionData?.leagueId || leagueParam}\n          sessionData={sessionData || undefined}\n        />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}